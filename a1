<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart URL Redirect</title>
  <script>
    // üîó ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ short links map
    const links = {
      "a1": "https://example.com/page1",
      "b2": "https://example.com/page2",
      "c3": "https://example.com/page3"
    };

    // ‚úÖ URL path ‡¶•‡ßá‡¶ï‡ßá ‡¶∂‡ßá‡¶∑‡ßá‡¶∞ ‡¶Ö‡¶Ç‡¶∂‡¶ü‡¶æ (key) ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ
    const pathParts = location.pathname.split("/");
    const key = pathParts[pathParts.length - 1].trim();

    // üß† Firebase Database URL
    const FIREBASE_URL = "https://urlshortener-d1814-default-rtdb.asia-southeast1.firebasedatabase.app/";

    // üìà Visit ‡¶≤‡¶ó ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    async function logVisit(shortCode) {
      const data = {
        short: shortCode,
        time: new Date().toISOString(),
        ua: navigator.userAgent,
        ref: document.referrer || "Direct"
      };

      try {
        await fetch(`${FIREBASE_URL}/visits.json`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(data)
        });
      } catch (e) {
        console.error("Log failed:", e);
      }
    }

    // üöÄ Redirect logic
    window.onload = function() {
      if (links[key]) {
        logVisit(key).finally(() => {
          window.location.href = links[key];
        });
      } else {
        document.body.innerHTML = `
          <div style="text-align:center;margin-top:20%;">
            <h2>‚ùå Invalid or expired link</h2>
            <p>This shortlink does not exist.</p>
          </div>
        `;
      }
    };
  </script>
</head>
<body></body>
</html>
